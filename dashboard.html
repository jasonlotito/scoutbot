<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Twitch Blackjack Bot Dashboard</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1>üÉè Twitch Blackjack Bot</h1>
                <div class="status-indicator">
                    <span id="connection-status" class="status-dot offline"></span>
                    <span id="connection-text">Disconnected</span>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Control Panel -->
            <section class="card control-panel">
                <h2>Control Panel</h2>
                <div class="controls">
                    <button id="start-btn" class="btn btn-primary">Start Bot</button>
                    <button id="stop-btn" class="btn btn-secondary" disabled>Stop Bot</button>
                    <button id="config-btn" class="btn btn-outline">Settings</button>
                    <button id="create-env-btn" class="btn btn-small" style="display: none;">Create .env File</button>
                </div>
            </section>

            <!-- Status Overview -->
            <section class="card status-overview">
                <h2>Status Overview</h2>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="uptime">--</div>
                        <div class="stat-label">Uptime</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="channels-count">0</div>
                        <div class="stat-label">Channels</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="active-games">0</div>
                        <div class="stat-label">Active Games</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="total-commands">0</div>
                        <div class="stat-label">Commands Processed</div>
                    </div>
                </div>
            </section>

            <!-- Channels -->
            <section class="card channels-section">
                <h2>Connected Channels</h2>
                <div id="channels-list" class="channels-list">
                    <p class="empty-state">No channels connected</p>
                </div>
            </section>

            <!-- Active Games -->
            <section class="card games-section">
                <h2>Active Games</h2>
                <div id="games-list" class="games-list">
                    <p class="empty-state">No active games</p>
                </div>
            </section>

            <!-- Player Statistics -->
            <section class="card stats-section">
                <h2>Player Statistics</h2>
                <div class="stats-summary">
                    <div class="stat-item">
                        <div class="stat-value" id="total-players">0</div>
                        <div class="stat-label">Total Players</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="total-games-played">0</div>
                        <div class="stat-label">Games Played</div>
                    </div>
                </div>
                <div id="top-players" class="top-players">
                    <p class="empty-state">No player data available</p>
                </div>
            </section>

            <!-- Advertisement System -->
            <section class="card ad-section">
                <h2>Advertisement System</h2>
                <div class="ad-controls">
                    <div class="ad-status">
                        <span id="ad-status" class="status-indicator">‚óè</span>
                        <span id="ad-status-text">Loading...</span>
                    </div>
                    <button id="ad-settings-btn" class="btn btn-small">Settings</button>
                </div>
                <div class="ad-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="ad-interval">5</div>
                        <div class="stat-label">Interval (min)</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="ad-min-messages">10</div>
                        <div class="stat-label">Min Messages</div>
                    </div>
                </div>
                <div id="ad-channel-stats" class="ad-channel-stats">
                    <p class="empty-state">No advertisement data available</p>
                </div>
            </section>

            <!-- Activity Log -->
            <section class="card activity-section">
                <h2>Activity Log</h2>
                <div class="activity-controls">
                    <button id="clear-log-btn" class="btn btn-small">Clear Log</button>
                    <button id="export-logs-btn" class="btn btn-small">Export Logs</button>
                </div>
                <div id="activity-log" class="activity-log">
                    <p class="log-entry">Bot dashboard started</p>
                </div>
            </section>
        </main>
    </div>

    <!-- Configuration Modal -->
    <div id="config-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Bot Configuration</h3>
                <button id="close-modal" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="config-info">
                    <p><strong>üí° Configuration Tips:</strong></p>
                    <ul>
                        <li>Leave password fields empty to keep existing values</li>
                        <li>Changes are saved to your <code>.env</code> file</li>
                        <li>Restart the bot after changing credentials</li>
                    </ul>
                </div>
                <form id="config-form">
                    <div class="form-group">
                        <label for="client-id">Client ID:</label>
                        <input type="text" id="client-id" name="clientId" required>
                        <small>Get from <a href="https://dev.twitch.tv/console/apps" target="_blank">Twitch Developer Console</a></small>
                    </div>
                    
                    <div class="form-group">
                        <label for="client-secret">Client Secret:</label>
                        <input type="password" id="client-secret" name="clientSecret" required>
                        <small>From your Twitch application</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="access-token">Access Token:</label>
                        <input type="password" id="access-token" name="accessToken" required>
                        <small>Get from <a href="https://twitchtokengenerator.com/" target="_blank">Twitch Token Generator</a></small>
                    </div>
                    
                    <div class="form-group">
                        <label for="refresh-token">Refresh Token (Optional):</label>
                        <input type="password" id="refresh-token" name="refreshToken">
                        <small>For automatic token refresh</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="channels">Channels (comma-separated):</label>
                        <input type="text" id="channels" name="channels" placeholder="channel1,channel2" required>
                        <small>Channel names without # prefix</small>
                    </div>
                </form>

                <div class="troubleshooting-section">
                    <h4>üîß Troubleshooting</h4>
                    <details>
                        <summary>Bot won't connect?</summary>
                        <ul>
                            <li>Verify your Client ID and Secret are correct</li>
                            <li>Ensure Access Token has <code>chat:read</code> and <code>chat:edit</code> scopes</li>
                            <li>Check that channel names don't include the # symbol</li>
                            <li>Make sure your Twitch application is properly configured</li>
                        </ul>
                    </details>

                    <details>
                        <summary>Commands not working?</summary>
                        <ul>
                            <li>Ensure the bot is connected (green status indicator)</li>
                            <li>Check that you're in the correct channel</li>
                            <li>Verify the bot account has chat permissions</li>
                            <li>Try restarting the bot after configuration changes</li>
                        </ul>
                    </details>

                    <details>
                        <summary>Token expired?</summary>
                        <ul>
                            <li>Generate a new Access Token from the token generator</li>
                            <li>Update the token in settings and restart the bot</li>
                            <li>Consider adding a Refresh Token for automatic renewal</li>
                        </ul>
                    </details>

                    <details>
                        <summary>Need help with setup?</summary>
                        <ul>
                            <li><strong>Client ID/Secret:</strong> <a href="https://dev.twitch.tv/console/apps" target="_blank">Twitch Developer Console</a></li>
                            <li><strong>Access Token:</strong> <a href="https://twitchtokengenerator.com/" target="_blank">Twitch Token Generator</a></li>
                            <li><strong>Scopes needed:</strong> chat:read, chat:edit</li>
                            <li><strong>OAuth Redirect:</strong> Use http://localhost:3000 or any URL</li>
                        </ul>
                    </details>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" id="save-config" class="btn btn-primary">Save Configuration</button>
                <button type="button" id="cancel-config" class="btn btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Advertisement Settings Modal -->
    <div id="ad-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Advertisement Settings</h2>
                <span class="close" id="close-ad-modal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="info-banner">
                    <p><strong>üíæ Persistent Settings:</strong> These settings are saved immediately and don't require the bot to be running. Changes will apply when the bot starts or restarts.</p>
                </div>
                <form id="ad-settings-form">
                    <div class="form-group">
                        <label for="ad-enabled">
                            <input type="checkbox" id="ad-enabled" name="enabled">
                            Enable Advertisements
                        </label>
                        <small>Automatically promote the blackjack game in chat</small>
                    </div>

                    <div class="form-group">
                        <label for="ad-interval">Advertisement Interval (minutes)</label>
                        <input type="number" id="ad-interval-input" name="intervalMinutes" min="1" max="60" value="5">
                        <small>How often to potentially send advertisements</small>
                    </div>

                    <div class="form-group">
                        <label for="ad-min-messages">Minimum Messages Required</label>
                        <input type="number" id="ad-min-messages-input" name="minMessagesSinceLastAd" min="1" max="100" value="10">
                        <small>Chat messages needed before sending an ad (prevents spam in slow chats)</small>
                    </div>

                    <div class="form-group">
                        <label>Current Advertisement Messages:</label>
                        <div id="ad-messages-preview" class="ad-messages-preview">
                            <p>üÉè Want to play blackjack? Type !deal to start a game!</p>
                            <p>üé≤ Ready for some blackjack action? Use !deal to start!</p>
                            <p>‚ô†Ô∏è Blackjack time! Start with !deal, join with !join!</p>
                            <p>üéØ Test your luck at blackjack! Commands: !deal, !join, !hit, !stand</p>
                        </div>
                        <small>Messages rotate automatically to keep chat fresh</small>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancel-ad-settings">Cancel</button>
                <button type="submit" class="btn btn-primary" id="save-ad-settings">Save Settings</button>
            </div>
        </div>
    </div>

    <!-- Authentication Wizard Modal -->
    <div id="auth-wizard-modal" class="modal">
        <div class="modal-content auth-wizard">
            <div class="modal-header">
                <h2>üîê Authentication Setup Wizard</h2>
                <div class="wizard-progress">
                    <div class="progress-step active" data-step="1">1</div>
                    <div class="progress-line"></div>
                    <div class="progress-step" data-step="2">2</div>
                    <div class="progress-line"></div>
                    <div class="progress-step" data-step="3">3</div>
                </div>
            </div>
            <div class="modal-body">
                <!-- Step 1: App Registration -->
                <div id="auth-step-1" class="auth-step active">
                    <h3>Step 1: Create Twitch Application</h3>
                    <p>First, you need to register your bot as a Twitch application to get credentials.</p>

                    <div class="auth-instructions">
                        <ol>
                            <li>Click the button below to open the Twitch Developer Console</li>
                            <li>Click "Register Your Application"</li>
                            <li>Fill in the form:
                                <ul>
                                    <li><strong>Name:</strong> Your bot name (e.g., "MyBlackjackBot")</li>
                                    <li><strong>OAuth Redirect URLs:</strong> <code>http://localhost:3000/auth/callback</code></li>
                                    <li><strong>Category:</strong> Chat Bot</li>
                                </ul>
                            </li>
                            <li>Click "Create" and copy your <strong>Client ID</strong> and <strong>Client Secret</strong></li>
                        </ol>
                    </div>

                    <div class="auth-action">
                        <button type="button" class="btn btn-primary" id="open-twitch-console">
                            üîó Open Twitch Developer Console
                        </button>
                    </div>

                    <div class="form-group">
                        <label for="wizard-client-id">Client ID</label>
                        <input type="text" id="wizard-client-id" placeholder="Enter your Client ID">
                        <small>Copy this from your Twitch application</small>
                    </div>

                    <div class="form-group">
                        <label for="wizard-client-secret">Client Secret</label>
                        <input type="password" id="wizard-client-secret" placeholder="Enter your Client Secret">
                        <small>Copy this from your Twitch application (keep it secret!)</small>
                    </div>
                </div>

                <!-- Step 2: OAuth Authorization -->
                <div id="auth-step-2" class="auth-step">
                    <h3>Step 2: Authorize Bot Permissions</h3>
                    <p>Now we'll get permission for your bot to read and send chat messages.</p>

                    <div class="auth-status" id="auth-status">
                        <div class="status-item">
                            <span class="status-icon">‚è≥</span>
                            <span>Ready to authorize</span>
                        </div>
                    </div>

                    <div class="auth-instructions">
                        <p>When you click "Authorize Bot", we will:</p>
                        <ol>
                            <li>Start a local server to receive the authorization</li>
                            <li>Open Twitch in your browser</li>
                            <li>Ask you to log in and authorize the bot</li>
                            <li>Automatically retrieve your access tokens</li>
                        </ol>
                        <p><strong>Note:</strong> Make sure to authorize with the Twitch account you want the bot to use!</p>
                    </div>
                </div>

                <!-- Step 3: Channel Configuration -->
                <div id="auth-step-3" class="auth-step">
                    <h3>Step 3: Configure Channels</h3>
                    <p>Finally, specify which Twitch channels your bot should join.</p>

                    <div class="form-group">
                        <label for="wizard-channels">Channels to Join</label>
                        <input type="text" id="wizard-channels" placeholder="channel1, channel2, channel3">
                        <small>Enter channel names separated by commas (without # symbol)</small>
                    </div>

                    <div class="auth-summary" id="auth-summary">
                        <h4>Configuration Summary:</h4>
                        <div class="summary-item">
                            <strong>Client ID:</strong> <span id="summary-client-id">Not set</span>
                        </div>
                        <div class="summary-item">
                            <strong>Authorization:</strong> <span id="summary-auth-status">Not authorized</span>
                        </div>
                        <div class="summary-item">
                            <strong>Channels:</strong> <span id="summary-channels">Not configured</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="auth-wizard-back" style="display: none;">Back</button>
                <button type="button" class="btn btn-secondary" id="auth-wizard-cancel">Cancel</button>
                <button type="button" class="btn btn-primary" id="auth-wizard-next">Next</button>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container" class="toast-container"></div>

    <script src="dashboard.js"></script>
</body>
</html>
